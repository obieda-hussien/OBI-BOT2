# 🤖 OBI-BOT2 - دليل التثبيت والتشغيل على الترمكس

## 📱 التثبيت على الترمكس (Termux)

### المتطلبات الأساسية
- هاتف أندرويد
- تطبيق Termux مثبت من [F-Droid](https://f-droid.org/en/packages/com.termux/) أو [GitHub](https://github.com/termux/termux-app/releases)
- اتصال بالإنترنت مستقر

### خطوات التثبيت

#### 1. تحديث الترمكس
افتح تطبيق Termux وقم بتحديث الحزم:
```bash
pkg update && pkg upgrade -y
```

#### 2. تثبيت Git
```bash
pkg install git -y
```

#### 3. استنساخ المشروع
```bash
git clone https://github.com/obieda-hussien/OBI-BOT2.git
cd OBI-BOT2
```

#### 4. تشغيل سكريبت التثبيت التلقائي
```bash
bash termux-install.sh
```

سيقوم السكريبت بتثبيت جميع المتطلبات تلقائياً:
- Node.js
- Python
- FFmpeg
- ImageMagick
- جميع حزم Node.js المطلوبة

### 🚀 تشغيل البوت

#### الطريقة الأولى: باستخدام السكريبت
```bash
bash termux-start.sh
```

#### الطريقة الثانية: باستخدام npm
```bash
npm start
```

### 📋 خطوات الاتصال بالواتساب

1. بعد تشغيل البوت، ستظهر لك قائمة بطريقتين للاتصال:
   - **الطريقة 1**: الاتصال عبر كود QR
   - **الطريقة 2**: الاتصال عبر كود مكون من 8 أرقام

2. **إذا اخترت كود QR (الخيار 1)**:
   - سيظهر كود QR على الشاشة
   - افتح تطبيق الواتساب
   - اذهب إلى الإعدادات > الأجهزة المرتبطة
   - اضغط على "ربط جهاز"
   - امسح الكود الظاهر

3. **إذا اخترت الكود المكون من 8 أرقام (الخيار 2)**:
   - أدخل رقم الواتساب الخاص بك بالصيغة الدولية
   - مثال: `+201234567890`
   - سيتم إرسال كود مكون من 8 أرقام
   - افتح تطبيق الواتساب
   - اذهب إلى الإعدادات > الأجهزة المرتبطة
   - اضغط على "ربط جهاز"
   - اختر "ربط باستخدام رقم الهاتف بدلاً من ذلك"
   - أدخل الكود المكون من 8 أرقام

### ⚙️ الإعدادات

يمكنك تعديل إعدادات البوت من خلال ملف `config.js`:

```bash
nano config.js
```

### 🔄 إعادة تشغيل البوت

لإيقاف البوت: اضغط `Ctrl + C`

لإعادة تشغيله:
```bash
bash termux-start.sh
```

### 📝 ملاحظات مهمة

1. **الحفاظ على الترمكس نشطاً**:
   - لمنع الأندرويد من إيقاف الترمكس، استخدم خاصية "Wake Lock"
   - اسحب من أعلى الشاشة في الترمكس واضغط على "ACQUIRE WAKELOCK"

2. **التشغيل في الخلفية**:
   ```bash
   npm start > output.log 2>&1 &
   ```

3. **عرض السجلات**:
   ```bash
   tail -f output.log
   ```

4. **التحقق من العمليات الجارية**:
   ```bash
   ps aux | grep node
   ```

### 🛠️ حل المشاكل الشائعة

#### مشكلة: "خطأ EACCES: permission denied, symlink" أثناء npm install
هذه المشكلة شائعة في Termux على Android، خاصة عند التثبيت في مسار التخزين الخارجي.

**الحل:**
```bash
# احذف node_modules وملف القفل
rm -rf node_modules package-lock.json

# نظف ذاكرة التخزين المؤقت
npm cache clean --force

# أعد التثبيت باستخدام العلامات المناسبة للترمكس
npm install --no-bin-links --legacy-peer-deps
```

**ملاحظة مهمة:** 
- استخدم دائماً `--no-bin-links` عند التثبيت في Termux لتجنب مشاكل الروابط الرمزية
- إذا استمرت المشكلة، انقل المشروع إلى المجلد الرئيسي للترمكس:
  ```bash
  cd ~
  git clone https://github.com/obieda-hussien/OBI-BOT2.git
  cd OBI-BOT2
  bash termux-install.sh
  ```

#### مشكلة: "Cannot find package 'cfonts'" أو أي حزمة أخرى
هذا يعني أن npm install لم يكتمل بنجاح.

**الحل:**
```bash
# تأكد من تثبيت جميع الحزم بشكل صحيح
npm install --no-bin-links --legacy-peer-deps

# إذا استمرت المشكلة، جرب التثبيت اليدوي للحزمة المفقودة
npm install cfonts --no-bin-links
```

#### مشكلة: "Node.js غير مثبت"
```bash
pkg install nodejs-lts -y
```

#### مشكلة: "خطأ في الاتصال"
1. تأكد من اتصالك بالإنترنت
2. أعد تشغيل الترمكس
3. احذف مجلد الجلسة وأعد المسح:
```bash
rm -rf Data/Sesiones/Principal
npm start
```

#### مشكلة: "نفاد مساحة التخزين"
```bash
# تنظيف الملفات المؤقتة
rm -rf tmp/*
# تنظيف ذاكرة التخزين المؤقت لـ npm
npm cache clean --force
```

#### ملاحظة: تحذيرات الأمان أثناء التثبيت
قد تظهر تحذيرات أمنية (vulnerabilities) أثناء تثبيت الحزم مثل:
```
45 vulnerabilities (2 low, 12 moderate, 24 high, 7 critical)
```

**هذا طبيعي ولا يؤثر على عمل البوت!**

**التفسير:**
- معظم هذه التحذيرات من حزم فرعية (sub-dependencies) لا يمكن تحديثها مباشرة
- سكريبت التثبيت يحاول إصلاح ما يمكن إصلاحه تلقائياً
- الحزم المتبقية آمنة للاستخدام في بيئة الترمكس

**لتقليل التحذيرات (اختياري):**
```bash
# تحديث الحزم التي يمكن تحديثها بأمان
npm update --no-bin-links --legacy-peer-deps

# محاولة إصلاح الثغرات
npm audit fix --no-bin-links --legacy-peer-deps
```

**ملاحظة مهمة:** 
- استخدام `npm audit fix --force` قد يكسر البوت - لا يُنصح به
- التحذيرات الأمنية لا تمنع البوت من العمل
- البوت يعمل بشكل طبيعي مع هذه التحذيرات

#### مشكلة: خطأ في تحميل حزمة "sharp" (معالجة الصور)
قد تظهر رسالة خطأ:
```
Error: Could not load the "sharp" module using the android-arm64 runtime
```

**الحل:**
```bash
# تثبيت مكتبة libvips المطلوبة
pkg install libvips -y

# إعادة بناء حزمة sharp
cd ~/OBI-BOT2
npm rebuild sharp --no-bin-links

# إعادة تشغيل البوت
npm start
```

**ملاحظة:**
- سكريبت `termux-install.sh` يقوم بتثبيت libvips تلقائياً
- عند إعادة بناء sharp، قد تظهر رسائل تفصيلية من `node-gyp` - **هذا طبيعي**
- الرسائل مثل "gyp info" و "sharp: Building from source" تعني أن البناء يعمل بشكل صحيح
- إذا استمرت المشكلة، البوت سيعمل ولكن بعض ميزات معالجة الصور قد لا تعمل
- هذا لا يؤثر على الوظائف الأساسية للبوت

### 📦 تحديث البوت

للحصول على آخر التحديثات:
```bash
cd OBI-BOT2
git pull
npm install
npm start
```

### 🔒 الأمان

- لا تشارك ملفات الجلسة (`Data/Sesiones/`) مع أي شخص
- احتفظ بنسخة احتياطية من ملفات الجلسة بشكل دوري
- لا تقم بتشغيل أوامر من مصادر غير موثوقة

### 📞 الدعم

إذا واجهت أي مشاكل:
1. تحقق من قسم "حل المشاكل الشائعة" أعلاه
2. افتح Issue جديد على GitHub
3. تواصل مع المطور

### 📄 الترخيص

هذا المشروع مرخص تحت رخصة MIT - انظر ملف LICENSE للتفاصيل

---

**تم تطوير هذا البوت خصيصاً للعمل على الترمكس بكفاءة عالية** ✨
